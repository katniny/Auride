<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Auride</title>
        <link rel="shortcut icon" href="assets/imgs/favicon.png" type="image/png">
        
        <!-- css -->
        <link rel="stylesheet" href="assets/css/all.css">

        <!-- scripts -->
        <script src="assets/js/requiredScripts.js" type="module"></script>
        <script defer type="module">
            import { ScriptLoader } from "./assets/js/scriptLoader.js";

            ScriptLoader.load(
                { src: "assets/js/test.js", async: false, type: "module" }
            ).then(() => {
                console.log("Scripts for this page have been loaded successfully.");
            }).catch((error) => {
                console.error("An error occurred: ", error, " please try refreshing.");
            });
        </script>
    </head>
    
    <body>
        <script defer type="module">
            export async function fetchProtectedUserData() {
                const auth = firebase.auth();
                const user = auth.currentUser;

                if (!user) {
                    console.error("User not logged in.");
                    return;
                }

                try {
                    const token = await user.getIdToken();

                    const response = await fetch(`${import.meta.env.VITE_SERVER_URL}/api/auride/getUser`, {
                        method: "GET",
                        headers: {
                            "Authorization": `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        const error = await response.json();
                        console.log("User data from server:", userData);
                        return;
                    }

                    const userData = await response.json();
                    console.log("User data from server:", userData);
                } catch (err) {
                    console.error("Failed to fetch user data", err);
                }
            }

            window.fetchProtectedUserData = fetchProtectedUserData;
        </script>
    </body>
</html>