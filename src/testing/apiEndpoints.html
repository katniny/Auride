<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Auride | API Endpoint Testing</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                font-family: sans-serif;
            }

            body {
                color: #fff;
                background: #000;
                margin: 15px;
            }

            ul {
                margin-left: 15px;
            }
        </style>
        <link rel="shortcut icon" href="/assets/imgs/favicon.png" type="image/png">
    </head>
    
    <body>
        <p>Auride API endpoint testing to ensure our API is working as intended.</p>
        <p>Built specifically for these use cases:</p>
        <ul>
            <li>Testing GET, POST, PUT, PATCH, or DELETE methods (any others are unsupported!)</li>
            <li>Testing data that we receive</li>
        </ul>
        <br />
        <p><b>NOT</b> built for:</p>
        <ul>
            <li>Testing for non-host URLs restrictions</li>
            <li>Testing how it works in production</li>
        </ul>

        <br />
        <br />

        <h2>Fetch Method</h2>
        <p>Only GET, POST, PUT, PATCH, or DELETE methods.</p>
        <input type="text" placeholder="Insert fetch method" id="fetchMethod" />

        <br />
        <br />
        
        <h2>URL Endpoint</h2>
        <p>Formatted as /api/[?], <b>NOT</b> http://localhost:PORT/api/[?]. This page assumes your server is running at http://localhost:10000 locally, which it should be if it is not.</p>
        <input type="text" placeholder="Insert URL endpoint" id="urlEndpoint" />
    
        <br />
        <br />

        <button onclick="getRequestedFetch()">Run</button>

        <br />
        <br />
        <br />

        <pre id="result">
            
        </pre>

        <!-- the script that makes this run -->
        <script>
            // get requested fetch to get the inputs of the fields
            function getRequestedFetch() {
                const method = document.getElementById("fetchMethod").value;
                const urlEndpoint = document.getElementById("urlEndpoint").value;
                const result = document.getElementById("result");

                // make sure the method exists
                if (method.trim() === "") {
                    result.innerHTML = "Your requested fetch method is empty!";
                    return;
                }

                // make sure the endpoint exists
                if (urlEndpoint.trim() === "") {
                    result.innerHTML = "Your URL endpoint is empty!";
                    return;
                }

                // make sure that the method is valid
                if (
                    method !== "GET" && method !== "POST" &&
                    method !== "PUT" && method !== "PATCH" &&
                    method !== "DELETE"
                ) {
                    result.innerHTML = "Your method is unsupported. Please only use GET, POST, PUT, PATCH, or DELETE.";
                    return;
                }

                // make sure urlEndpoint starts with a slash
                if (!urlEndpoint.startsWith("/")) {
                    result.innerHTML = "Please ensure the URL endpoint starts with a forward slash."
                    return;
                }

                // else, everything is correct! :D
                request(urlEndpoint, method);
            }
            
            // finally, our request
            async function request(urlEndpoint, method) {
                const options = { method };
                const result = document.getElementById("result");

                // fetch resposne
                const response = await fetch(`http://localhost:10000${urlEndpoint}`, options);
                if (!response.ok) {
                    const errorText = await response.text();
                    result.innerHTML = `HTTP error! Status: ${response.status}${errorText}`;
                    return;
                }

                const responseJSON = await response.json();
                const responseText = JSON.stringify(responseJSON, null, 2);
                console.log(responseJSON);
                result.innerHTML = responseText;
            }
        </script>
    </body>
</html>